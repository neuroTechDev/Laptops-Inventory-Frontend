<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Add New Laptop</title>
    <style>
      form {
        width: 60%;
        margin: auto;
        display: flex;
        flex-direction: column;
        gap: 12px;
        font-family: sans-serif;
      }

      input,
      select {
        padding: 8px;
        font-size: 14px;
      }

      button#submit {
        padding: 10px;
        background-color: #333;
        color: white;
        border: 5px solid #333;
        cursor: pointer;
      }

      button#dateButton {
        background-color: #e7e7e7;
        color: rgb(51, 51, 51);
      }
      h2 {
        text-align: center;
      }
    </style>
  </head>
  <body>
    <h2>Add a New Laptop</h2>
    <button id="submit" onclick="location.href='webSite.html'">
      Back To Home
    </button>

    <form id="laptopForm">
      <input name="procured" placeholder="Procured Date" />
      <input name="deviceInfo" placeholder="Device Info" />
      <input name="pcNumber" placeholder="PC Number" required />
      <input name="location" placeholder="Location Type" />
      <input name="serialNum" placeholder="Serial Number/Source" />

      <input name="price" type="number" step="0.01" placeholder="Value" />
      <input name="notes" placeholder="Notes" />
      <input name="email" type="email" placeholder="Email" />
      <input name="password" placeholder="Password" />
      <input name="userID" placeholder="User ID" />
      <input name="anyDesk" type="number" placeholder="AnyDesk ID" />
      <input name="r3thaVersion" placeholder="R3THA Version" />
      <input
        name="lastUpdate"
        id="lastUpdate"
        type="date"
        placeholder="Last Update"
      /><button type="button" id="dateButton" onclick="setTodayDate()">
        Set to Today
      </button>

      <script>
        function setTodayDate() {
          const today = new Date().toISOString().split("T")[0];
          document.getElementById("lastUpdate").value = today;
        }
      </script>
      <select name="status" not required>
        <option value="true">Available</option>
        <option value="false">In Use</option>
      </select>
      <button id="submit" type="submit">Submit</button>
    </form>

    <script>
      document
      .getElementById("laptopForm")
      .addEventListener("submit", async function (e) {
        e.preventDefault();
        const formData = new FormData(this);
        const data = Object.fromEntries(formData.entries());

        // Type conversion
        data.price = parseFloat(data.price);
        data.anyDesk = parseInt(data.anyDesk);
        data.status = data.status === "true";

        try {
          const API_BASE = "https://inventoryapptest-production.up.railway.app";

          const res = await fetch(`${API_BASE}/api/LapTop`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
          });
    
          if (res.ok) {
            alert("Laptop added!");
            window.location.href = "webSite.html";
          } else {
            alert("Error adding laptop.");
          }
        } catch (err) {
          console.error("Fetch error:", err);
          alert("Failed to connect to server.");
        }
      });
    </script>
  </body>

</html>