<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Laptop Detailed View</title>
    <style>
      form {
        width: 60%;
        margin: auto;
        display: flex;
        flex-direction: column;
        gap: 12px;
        font-family: sans-serif;
      }

      .group {
        display: flex;
        align-items: center;
        margin-bottom: 12px;
        gap: 12px;
        font-size: 16px;
      }

      .group label {
        width: 160px;
        font-weight: bold;
      }

      input,
      select {
        flex: 1;
        padding: 8px;
        font-size: 14px;
      }

      button#save {
        padding: 10px;
        background-color: #333;
        color: white;
        border: 5px solid #333;
        cursor: pointer;
        font-size: 14px;
      }

      button#dateButton {
        background-color: #e7e7e7;
        color: rgb(51, 51, 51);
        font-size: 14px;
        padding: 8px 10px;
        cursor: pointer;
      }
    </style>
  </head>

  <body>
    <h2>Edit Laptop Details</h2>

    <button onclick="location.href='webSite.html'">Back To Home</button>

    <form id="editLaptopForm">
      <a
        href="#"
        onclick="this.href = 'historyLog.html?pcNumber=' + document.querySelector('input[name=pcNumber]').value"
      >
        View History Log</a
      >
      <div class="group">
        <label for="procured">Procured Date:</label>
        <input id="procured" name="procured" placeholder="Procured Date" />
      </div>

      <div class="group">
        <label for="deviceInfo">Device Info:</label>
        <input id="deviceInfo" name="deviceInfo" placeholder="Device Info" />
      </div>

      <div class="group">
        <label for="pcNumber">PC Number:</label>
        <input id="pcNumber" name="pcNumber" placeholder="PC Number" readonly />
      </div>

      <div class="group">
        <label for="location">Location Type:</label>
        <input id="location" name="location" placeholder="Location Type" />
      </div>

      <div class="group">
        <label for="serialNum">Serial Number:</label>
        <input id="serialNum" name="serialNum" placeholder="Serial Number" />
      </div>

      <div class="group">
        <label for="price">Price:</label>
        <input
          id="price"
          name="price"
          type="number"
          step="0.01"
          placeholder="Price"
        />
      </div>

      <div class="group">
        <label for="notes">Notes:</label>
        <input id="notes" name="notes" placeholder="Notes" />
      </div>

      <div class="group">
        <label for="email">Email:</label>
        <input id="email" name="email" type="email" placeholder="Email" />
      </div>

      <div class="group">
        <label for="password">Password:</label>
        <input
          id="password"
          name="password"
          type="password"
          placeholder="Password"
        />
      </div>

      <div class="group">
        <label for="userID">User ID:</label>
        <input id="userID" name="userID" placeholder="User ID" />
      </div>

      <div class="group">
        <label for="anyDesk">AnyDesk ID:</label>
        <input
          id="anyDesk"
          name="anyDesk"
          type="number"
          placeholder="AnyDesk ID"
        />
      </div>

      <div class="group">
        <label for="r3thaVersion">R3THA Version:</label>
        <input
          id="r3thaVersion"
          name="r3thaVersion"
          placeholder="R3THA Version"
        />
      </div>

      <div class="group">
        <label for="lastUpdate">Last Update:</label>
        <input
          id="lastUpdate"
          name="lastUpdate"
          type="date"
          placeholder="Last Update"
        />
        <button type="button" id="dateButton" onclick="setTodayDate()">
          Set to Today
        </button>
      </div>

      <div class="group">
        <label for="status">Status:</label>
        <select name="status" id="status">
          <option value="true">Available</option>
          <option value="false">In Use</option>
        </select>
      </div>

      <div class="group">
        <button id="save" type="submit">Save Changes</button>
      </div>

      <script>
        function setTodayDate() {
          const today = new Date().toISOString().split("T")[0];
          document.getElementById("lastUpdate").value = today;
        }
      </script>
    </form>
      <script>
        const API_BASE = "https://inventoryapptest-production.up.railway.app";

        async function loadLaptopDetails() {
          const urlParams = new URLSearchParams(window.location.search);
          const pcNumber = urlParams.get("pcNumber");

          const res = await fetch(`${API_BASE}/api/LapTop/${pcNumber}`);
          const laptop = await res.json();

          const form = document.getElementById("editLaptopForm");
          for (const field in laptop) {
            if (form.elements[field]) {
              form.elements[field].value = laptop[field] || "";
            }
          }
        }
          
        document
            .getElementById("editLaptopForm")
            .addEventListener("submit", async function (e) {
            e.preventDefault();
            const formData = new FormData(this);
            const data = Object.fromEntries(formData.entries());

            data.price = parseFloat(data.price);
            data.anyDesk = parseInt(data.anyDesk);
            data.status = data.status === "true";

            const res = await fetch(`${API_BASE}/api/LapTop/${data.pcNumber}`, {
              method: "PUT",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(data),
            });

      if (res.ok) {
        alert("Laptop updated successfully!");
        window.location.href = "webSite.html";
      } else {
        alert("Error updating laptop.");
      }
    });

  loadLaptopDetails();
</script>
  </body>

</html>